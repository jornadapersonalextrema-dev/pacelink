module.exports=[9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},25327,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(19818);let f={easy_run:"Rodagem",progressive:"Progressivo",alternated:"Alternado"};function g(a){if(!a)return"—";let b=new Date(a);return Number.isNaN(b.getTime())?a:b.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}function h(a,b){return`${g(a)} – ${g(b)}`}function i(a){return String(a).padStart(2,"0")}function j(a){let b=a.getFullYear(),c=i(a.getMonth()+1),d=i(a.getDate());return`${b}-${c}-${d}`}function k(a){let b=new Date(a),c=b.getDay();return b.setDate(b.getDate()+(0===c?-6:1-c)),b.setHours(0,0,0,0),b}function l(a,b){let c=new Date(a);return c.setDate(c.getDate()+b),c}function m(){let a=(0,d.useParams)(),i=(0,d.useRouter)(),m=(0,c.useMemo)(()=>(0,e.createClient)(),[]),n=String(a?.id||""),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)("aluno"),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)({}),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(null);async function E(){B(!0),D(null);let{data:a,error:b}=await m.from("students").select("id, trainer_id, name, email, p1k_sec_per_km, public_slug, created_at").eq("id",n).maybeSingle();if(b){D(b.message),B(!1);return}if(!a){D("Aluno não encontrado."),B(!1);return}p(a),r(a.public_slug||"aluno"),B(!1)}async function F(a){let b=k(new Date),c=Array.from({length:8}).map((c,d)=>{let e=l(b,7*d),f=l(e,6);return{student_id:a.id,trainer_id:a.trainer_id,week_start:j(e),week_end:j(f),label:`Semana ${h(j(e),j(f))}`}}),d=await m.from("weeks").upsert(c,{onConflict:"student_id,week_start"});if(d.error)return void D(d.error.message);let{data:e,error:f}=await m.from("weeks").select("id, student_id, trainer_id, week_start, week_end, label").eq("student_id",a.id).order("week_start",{ascending:!0});if(f)return void D(f.message);let g=e||[];t(g);let i=j(k(new Date)),n=g.find(a=>a.week_start===i)||g[0]||null;v(n?.id||null)}async function G(a){if(!a){x([]),z({});return}let{data:b,error:c}=await m.from("workouts").select("id, student_id, trainer_id, status, template_type, title, total_km, created_at, planned_date, planned_day, share_slug, week_id, locked_at, closed_reason").eq("student_id",n).eq("week_id",a).order("planned_day",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1}).limit(200);if(c)return void D(c.message);let d=b||[];if(x(d),0===d.length)return void z({});let e=d.map(a=>a.id),{data:f,error:g}=await m.from("executions").select("id, workout_id, status, performed_at, completed_at, rpe, comment, last_event_at, started_at").in("workout_id",e);if(g)return void z({});let h={};for(let a of e)h[a]=null;for(let a of f||[]){let b=h[a.workout_id],c=b?.last_event_at||b?.completed_at||b?.started_at||"",d=a.last_event_at||a.completed_at||a.started_at||"";(!b||d&&d>c)&&(h[a.workout_id]=a)}z(h)}async function H(a){D(null);let{data:b,error:c}=await m.from("workouts").update({status:"ready"}).eq("id",a).select("id, share_slug").maybeSingle();if(c)return void D(c.message);let d=b?.share_slug;if(!d)return void D("Não foi possível gerar o link (share_slug).");let e=`${window.location.origin}/w/${q}/${d}`;await navigator.clipboard.writeText(e),D("Link do treino copiado para a área de transferência."),x(b=>b.map(b=>b.id===a?{...b,status:"ready",share_slug:d}:b))}(0,c.useEffect)(()=>{n&&E()},[n]),(0,c.useEffect)(()=>{o&&F(o)},[o?.id]),(0,c.useEffect)(()=>{G(u)},[u]);let I=s.find(a=>a.id===u)||null,J=(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Aluno"}),(0,b.jsx)("div",{className:"text-xl font-semibold truncate",children:o?.name??"—"}),(0,b.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300 mt-1",children:["Ritmo P1k: ",(0,b.jsx)("span",{className:"font-semibold",children:function(a){if(!a||a<=0)return"—";let b=Math.floor(a/60);return`${b}:${String(a%60).padStart(2,"0")}/km`}(o?.p1k_sec_per_km??null)}),o?.email?(0,b.jsxs)(b.Fragment,{children:[" · ",o.email]}):null]}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Links do aluno: ",(0,b.jsx)("span",{className:"font-mono",children:"/aluno"})," (login) ·"," ",(0,b.jsxs)("span",{className:"font-mono",children:["/w/",q,"/<treino>"]})]})]}),(0,b.jsxs)("div",{className:"shrink-0 flex flex-col items-end gap-2",children:[(0,b.jsx)("button",{className:"px-3 py-2 rounded-lg bg-slate-900 text-white text-sm font-semibold disabled:opacity-50",disabled:!u,onClick:()=>i.push(`/students/${n}/workouts/new?weekId=${u}`),children:"+ Programar treino"}),(0,b.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:()=>i.push("/students"),children:"Voltar"})]})]});return(0,b.jsx)("main",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-4",children:(0,b.jsxs)("div",{className:"mx-auto max-w-3xl space-y-4",children:[(0,b.jsx)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark shadow p-4",children:J}),C&&(0,b.jsx)("div",{className:"rounded-xl bg-amber-50 dark:bg-amber-900/20 p-3 text-sm text-amber-800 dark:text-amber-200",children:C}),A?(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Carregando…"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark shadow p-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold",children:"Planejamento por semana"}),(0,b.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:I?I.label||h(I.week_start,I.week_end):"—"})]})}),0===s.length?(0,b.jsxs)("div",{className:"mt-3 text-sm text-slate-600 dark:text-slate-300",children:["Semanas ainda não carregadas. Verifique se a tabela ",(0,b.jsx)("span",{className:"font-mono",children:"weeks"})," existe no Supabase."]}):(0,b.jsx)("div",{className:"mt-3 flex gap-2 overflow-x-auto no-scrollbar",children:s.map(a=>{let c=a.id===u;return(0,b.jsx)("button",{onClick:()=>v(a.id),className:"px-3 py-2 rounded-full text-sm font-semibold whitespace-nowrap border "+(c?"bg-primary text-slate-900 border-transparent":"bg-white dark:bg-surface-dark border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200"),children:h(a.week_start,a.week_end)},a.id)})})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark shadow p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h2",{className:"font-semibold",children:"Treinos da semana"}),(0,b.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Mostrando até 200"})]}),0===w.length?(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Nenhum treino programado para esta semana ainda."}):(0,b.jsx)("div",{className:"space-y-3",children:w.map(a=>{var c,d,e;let h=y[a.id],j=h?.status==="completed"?`Conclu\xeddo${h.performed_at?` (${g(h.performed_at)})`:""}`:h?.status==="in_progress"?"Em andamento":"—",k=!!a.locked_at||!!h,l=a.planned_day?`Ordem ${a.planned_day}`:a.planned_date?g(a.planned_date):g(a.created_at);return(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3 flex flex-col gap-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[l," · ",(d=a.status,e=a.closed_reason,"draft"===d?"Rascunho":"ready"===d?"Disponível":"archived"===d?"week_expired"===e?"Encerrado (sem execução)":"Encerrado":d)," · ",f[a.template_type]??a.template_type," ·"," ",null==(c=a.total_km)?"—":Number(c).toFixed(1).replace(".",",")," km"]}),(0,b.jsx)("div",{className:"font-medium truncate",children:a.title||f[a.template_type]||"Treino"}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Execução do aluno: ",(0,b.jsx)("span",{className:"font-semibold",children:j}),k?" · Edição bloqueada após início":""]})]}),(0,b.jsxs)("div",{className:"shrink-0 flex flex-wrap gap-2 justify-end",children:[(0,b.jsx)("button",{className:"px-3 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-sm font-semibold disabled:opacity-50",disabled:k,onClick:()=>i.push(`/workouts/${a.id}/edit`),children:"Editar"}),(0,b.jsx)("button",{className:"px-3 py-2 rounded-lg bg-primary text-slate-900 text-sm font-semibold disabled:opacity-50",disabled:"archived"===a.status,onClick:()=>H(a.id),children:"Gerar/Copiar link"}),(0,b.jsx)("button",{className:"px-3 py-2 rounded-lg bg-slate-900 text-white text-sm font-semibold disabled:opacity-50",disabled:!a.share_slug,onClick:()=>{let b;!(b=a.share_slug)?D('Treino sem link (share_slug). Use "Gerar/Copiar link".'):i.push(`/w/${q}/${b}`)},children:"Ver como aluno"})]})]}),a.share_slug?(0,b.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Link: ",(0,b.jsxs)("span",{className:"font-mono",children:["/w/",q,"/",a.share_slug]})]}):(0,b.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Link ainda não gerado (share_slug vazio)."})]},a.id)})})]})]})]})})}a.s(["default",()=>m])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__aec655a8._.js.map