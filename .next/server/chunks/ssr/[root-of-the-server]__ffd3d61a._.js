module.exports=[9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},81361,a=>{"use strict";var b=a.i(87924);let c=({title:a="PaceLink",showBack:c=!1,onBack:d,rightSlot:e,action:f,className:g=""})=>(0,b.jsx)("div",{className:`w-full bg-[#d1d1d1] ${g}`,children:(0,b.jsxs)("div",{className:"mx-auto max-w-2xl flex items-center justify-between px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[c?(0,b.jsx)("button",{type:"button",onClick:d,"aria-label":"Voltar",className:"text-white/90 hover:text-white",children:(0,b.jsx)("span",{className:"text-2xl leading-none",children:"‹"})}):null,(0,b.jsx)("div",{className:"text-white text-xl font-semibold truncate",children:a})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:e??f??null})]})});a.s(["Topbar",0,c,"default",0,c])},34136,a=>{"use strict";var b=a.i(87924);let c=({children:a,variant:c="primary",size:d="lg",icon:e,fullWidth:f=!0,className:g="",...h})=>(0,b.jsxs)("button",{className:`flex items-center justify-center gap-2 rounded-full font-bold transition-all active:scale-[0.98] ${{primary:"bg-primary text-background-dark shadow-lg shadow-primary/25 hover:bg-[#25c464]",secondary:"bg-white dark:bg-surface-dark border border-slate-200 dark:border-white/10 text-slate-900 dark:text-white",ghost:"bg-transparent text-slate-600 dark:text-slate-400 hover:bg-black/5 dark:hover:bg-white/5",danger:"bg-red-500 text-white shadow-lg shadow-red-500/20"}[c]} ${{sm:"h-9 px-4 text-xs",md:"h-11 px-6 text-sm",lg:"h-14 px-8 text-lg",xl:"h-16 px-10 text-xl"}[d]} ${f?"w-full":""} ${g}`,...h,children:[e&&(0,b.jsx)("span",{className:"material-symbols-outlined",children:e}),a]});a.s(["Button",0,c,"default",0,c])},85339,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(19818),f=a.i(81361),g=a.i(34136);let h={easy_run:"Rodagem",progressive:"Progressivo",alternated:"Alternado"};function i(a){if(!a)return"";let b=a.split("-");if(3!==b.length)return a;let[c,d,e]=b;return`${e}/${d}/${c}`}function j(a,b){let c=Number(a);return Number.isFinite(c)?c:b}function k(){let a=(0,d.useRouter)(),k=(0,d.useParams)(),l=(0,c.useMemo)(()=>(0,e.createClient)(),[]),m=k.studentSlug,n=k.shareSlug,[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(()=>{let a=new Date,b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${b}-${c}-${d}`}),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(null);async function G(){p(!0),F(null);let{data:{user:b}}=await l.auth.getUser();if(!b){let b=window.location.pathname+window.location.search;a.replace(`/login?next=${encodeURIComponent(b)}`);return}let{data:c,error:d}=await l.from("students").select("id,name,public_slug,p1k_pace,trainer_id").or(`auth_user_id.eq.${b.id},user_id.eq.${b.id}`).maybeSingle();if(d){F(d.message),p(!1);return}if(!c){F("Seu usuário não está vinculado a um aluno."),p(!1);return}if(c.public_slug&&c.public_slug!==m){F("Este link não corresponde ao seu perfil de aluno."),p(!1);return}r(c);let{data:e,error:f}=await l.from("workouts").select("id,student_id,trainer_id,status,title,template_type,include_warmup,warmup_km,include_cooldown,cooldown_km,blocks,total_km,planned_date,share_slug,version,locked_at").eq("share_slug",n).maybeSingle();if(f){F(f.message),p(!1);return}if(!e){F("Treino não encontrado ou indisponível."),p(!1);return}if(e.student_id!==c.id){F("Este treino não pertence ao seu perfil."),p(!1);return}if("ready"!==e.status&&"archived"!==e.status){F("Este treino ainda não está disponível."),p(!1);return}t(e),y||z(String(e.total_km??""));let{data:g}=await l.from("executions").select("id,workout_id,status,started_at,last_event_at,completed_at,performed_at,total_elapsed_ms,rpe,comment,actual_total_km").eq("workout_id",e.id).order("last_event_at",{ascending:!1,nullsFirst:!1}).order("started_at",{ascending:!1}).limit(1),h=g&&g.length>0?g[0]:null;v(h),h&&(h.performed_at&&x(h.performed_at),null!=h.actual_total_km&&z(String(h.actual_total_km)),null!=h.rpe&&B(String(h.rpe)),h.comment&&D(h.comment)),p(!1)}async function H(){if(!s||!q)return;F(null);let a=new Date().toISOString(),b={workout_id:s.id,student_id:q.id,trainer_id:s.trainer_id,status:"in_progress",started_at:a,last_event_at:a,performed_at:w||null,locked_version:s.version,workout_version:s.version,client_meta:{source:"portal_aluno"}},{data:c,error:d}=await l.from("executions").insert(b).select().maybeSingle();d?F(d.message||"Não foi possível iniciar a execução."):v(c)}async function I(){if(!u||!s)return;F(null);let a=new Date().toISOString(),b=u.started_at?new Date(u.started_at).getTime():Date.now(),c={status:"completed",completed_at:a,last_event_at:a,total_elapsed_ms:Math.max(0,Date.now()-b),performed_at:w||null,actual_total_km:y?j(y,s.total_km):s.total_km,rpe:A?Math.max(1,Math.min(10,j(A,0))):null,comment:C?C.trim():null,actual_blocks:s.blocks??[]},{data:d,error:e}=await l.from("executions").update(c).eq("id",u.id).select().maybeSingle();e?F(e.message||"Não foi possível concluir a execução."):v(d)}(0,c.useEffect)(()=>{G()},[m,n]);let J=!!s&&(!u||"completed"===u.status),K=u?.status==="in_progress",L=u?.status==="completed";return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.default,{title:"Treino do Aluno",action:(0,b.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:()=>a.push("/aluno"),children:"Voltar"})}),(0,b.jsx)("main",{className:"flex-1 p-4",children:o?(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Carregando…"}):E?(0,b.jsx)("div",{className:"rounded-xl bg-red-50 dark:bg-red-900/20 p-4 text-sm text-red-700 dark:text-red-300",children:E}):s&&q?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark p-4 shadow",children:[(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Aluno"}),(0,b.jsx)("div",{className:"text-lg font-semibold",children:q.name}),(0,b.jsxs)("div",{className:"mt-1 text-sm text-slate-600 dark:text-slate-300",children:[s.planned_date?`Planejado para ${i(s.planned_date)} \xb7 `:"",h[s.template_type]??s.template_type," · ",s.total_km," km"]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Título"}),(0,b.jsx)("div",{className:"font-medium",children:s.title||h[s.template_type]||"Treino"})]})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark p-4 shadow space-y-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Estrutura"}),s.include_warmup&&(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3",children:[(0,b.jsx)("div",{className:"font-medium",children:"Aquecimento"}),(0,b.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[s.warmup_km," km"]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3",children:[(0,b.jsx)("div",{className:"font-medium mb-2",children:"Blocos"}),(0,b.jsx)("div",{className:"space-y-2",children:0===(s.blocks??[]).length?(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Nenhum bloco definido."}):(s.blocks??[]).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsxs)("div",{className:"truncate",children:["Bloco ",c+1," · ",String(a.intensity??"").toUpperCase()]}),(0,b.jsxs)("div",{className:"font-semibold",children:[a.distance_km??a.distanceKm??a.km??"—"," km"]})]},c))})]}),s.include_cooldown&&(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3",children:[(0,b.jsx)("div",{className:"font-medium",children:"Desaquecimento"}),(0,b.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[s.cooldown_km," km"]})]})]}),(0,b.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark p-4 shadow space-y-3",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Registro do realizado"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Data realizada"}),(0,b.jsx)("input",{type:"date",value:w,onChange:a=>x(a.target.value),className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Distância realizada (km)"}),(0,b.jsx)("input",{inputMode:"decimal",value:y,onChange:a=>z(a.target.value),placeholder:String(s.total_km),className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"RPE (1–10)"}),(0,b.jsx)("input",{inputMode:"numeric",value:A,onChange:a=>B(a.target.value),placeholder:"Opcional",className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Comentário (opcional)"}),(0,b.jsx)("textarea",{value:C,onChange:a=>D(a.target.value),rows:3,placeholder:"Como você se sentiu? Alguma observação?",className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]})]}),L?(0,b.jsxs)("div",{className:"rounded-xl bg-green-50 dark:bg-green-900/20 p-3 text-sm text-green-800 dark:text-green-200",children:["Treino concluído",u?.performed_at?` em ${i(u.performed_at)}`:"","."]}):K?(0,b.jsx)("div",{className:"rounded-xl bg-amber-50 dark:bg-amber-900/20 p-3 text-sm text-amber-800 dark:text-amber-200",children:"Execução em andamento."}):(0,b.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Quando iniciar e concluir, o treino ficará registrado no seu histórico."}),(0,b.jsxs)("div",{className:"flex gap-2",children:[J&&(0,b.jsx)(g.default,{onClick:H,fullWidth:!0,children:"Iniciar execução"}),K&&(0,b.jsx)(g.default,{onClick:I,fullWidth:!0,children:"Concluir execução"})]}),L&&(0,b.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:H,children:"Registrar nova tentativa"})]})]}):null})]})}a.s(["default",()=>k])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ffd3d61a._.js.map