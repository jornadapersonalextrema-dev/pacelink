(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,a)=>{t.exports=e.r(76562)},16717,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(27972);let l={easy_run:"Rodagem",progressive:"Progressivo",alternated:"Alternado"};function d(e){if(!e)return"—";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}function n(e,t){return`${d(e)} – ${d(t)}`}function i(e){return String(e).padStart(2,"0")}function o(e){let t=e.getFullYear(),a=i(e.getMonth()+1),s=i(e.getDate());return`${t}-${a}-${s}`}function c(e){let t=new Date(e),a=t.getDay();return t.setDate(t.getDate()+(0===a?-6:1-a)),t.setHours(0,0,0,0),t}function u(e,t){let a=new Date(e);return a.setDate(a.getDate()+t),a}function m(){let e=(0,s.useParams)(),i=(0,s.useRouter)(),m=(0,a.useMemo)(()=>(0,r.createClient)(),[]),x=String(e?.id||""),[p,f]=(0,a.useState)(null),[h,g]=(0,a.useState)("aluno"),[_,k]=(0,a.useState)([]),[b,w]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[N,y]=(0,a.useState)({}),[S,$]=(0,a.useState)(!0),[C,D]=(0,a.useState)(null);async function E(){$(!0),D(null);let{data:e,error:t}=await m.from("students").select("id, trainer_id, name, email, p1k_sec_per_km, public_slug, created_at").eq("id",x).maybeSingle();if(t){D(t.message),$(!1);return}if(!e){D("Aluno não encontrado."),$(!1);return}f(e),g(e.public_slug||"aluno"),$(!1)}async function T(e){let t=c(new Date),a=Array.from({length:8}).map((a,s)=>{let r=u(t,7*s),l=u(r,6);return{student_id:e.id,trainer_id:e.trainer_id,week_start:o(r),week_end:o(l),label:`Semana ${n(o(r),o(l))}`}}),s=await m.from("weeks").upsert(a,{onConflict:"student_id,week_start"});if(s.error)return void D(s.error.message);let{data:r,error:l}=await m.from("weeks").select("id, student_id, trainer_id, week_start, week_end, label").eq("student_id",e.id).order("week_start",{ascending:!0});if(l)return void D(l.message);let d=r||[];k(d);let i=o(c(new Date)),x=d.find(e=>e.week_start===i)||d[0]||null;w(x?.id||null)}async function q(e){if(!e){v([]),y({});return}let{data:t,error:a}=await m.from("workouts").select("id, student_id, trainer_id, status, template_type, title, total_km, created_at, planned_date, planned_day, share_slug, week_id, locked_at, closed_reason").eq("student_id",x).eq("week_id",e).order("planned_day",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1}).limit(200);if(a)return void D(a.message);let s=t||[];if(v(s),0===s.length)return void y({});let r=s.map(e=>e.id),{data:l,error:d}=await m.from("executions").select("id, workout_id, status, performed_at, completed_at, rpe, comment, last_event_at, started_at").in("workout_id",r);if(d)return void y({});let n={};for(let e of r)n[e]=null;for(let e of l||[]){let t=n[e.workout_id],a=t?.last_event_at||t?.completed_at||t?.started_at||"",s=e.last_event_at||e.completed_at||e.started_at||"";(!t||s&&s>a)&&(n[e.workout_id]=e)}y(n)}async function P(e){D(null);let{data:t,error:a}=await m.from("workouts").update({status:"ready"}).eq("id",e).select("id, share_slug").maybeSingle();if(a)return void D(a.message);let s=t?.share_slug;if(!s)return void D("Não foi possível gerar o link (share_slug).");let r=`${window.location.origin}/w/${h}/${s}`;await navigator.clipboard.writeText(r),D("Link do treino copiado para a área de transferência."),v(t=>t.map(t=>t.id===e?{...t,status:"ready",share_slug:s}:t))}(0,a.useEffect)(()=>{x&&E()},[x]),(0,a.useEffect)(()=>{p&&T(p)},[p?.id]),(0,a.useEffect)(()=>{q(b)},[b]);let R=_.find(e=>e.id===b)||null,A=(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Aluno"}),(0,t.jsx)("div",{className:"text-xl font-semibold truncate",children:p?.name??"—"}),(0,t.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300 mt-1",children:["Ritmo P1k: ",(0,t.jsx)("span",{className:"font-semibold",children:function(e){if(!e||e<=0)return"—";let t=Math.floor(e/60);return`${t}:${String(e%60).padStart(2,"0")}/km`}(p?.p1k_sec_per_km??null)}),p?.email?(0,t.jsxs)(t.Fragment,{children:[" · ",p.email]}):null]}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Links do aluno: ",(0,t.jsx)("span",{className:"font-mono",children:"/aluno"})," (login) ·"," ",(0,t.jsxs)("span",{className:"font-mono",children:["/w/",h,"/<treino>"]})]})]}),(0,t.jsxs)("div",{className:"shrink-0 flex flex-col items-end gap-2",children:[(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg bg-slate-900 text-white text-sm font-semibold disabled:opacity-50",disabled:!b,onClick:()=>i.push(`/students/${x}/workouts/new?weekId=${b}`),children:"+ Programar treino"}),(0,t.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:()=>i.push("/students"),children:"Voltar"})]})]});return(0,t.jsx)("main",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-4",children:(0,t.jsxs)("div",{className:"mx-auto max-w-3xl space-y-4",children:[(0,t.jsx)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark shadow p-4",children:A}),C&&(0,t.jsx)("div",{className:"rounded-xl bg-amber-50 dark:bg-amber-900/20 p-3 text-sm text-amber-800 dark:text-amber-200",children:C}),S?(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Carregando…"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark shadow p-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:"Planejamento por semana"}),(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:R?R.label||n(R.week_start,R.week_end):"—"})]})}),0===_.length?(0,t.jsxs)("div",{className:"mt-3 text-sm text-slate-600 dark:text-slate-300",children:["Semanas ainda não carregadas. Verifique se a tabela ",(0,t.jsx)("span",{className:"font-mono",children:"weeks"})," existe no Supabase."]}):(0,t.jsx)("div",{className:"mt-3 flex gap-2 overflow-x-auto no-scrollbar",children:_.map(e=>{let a=e.id===b;return(0,t.jsx)("button",{onClick:()=>w(e.id),className:"px-3 py-2 rounded-full text-sm font-semibold whitespace-nowrap border "+(a?"bg-primary text-slate-900 border-transparent":"bg-white dark:bg-surface-dark border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200"),children:n(e.week_start,e.week_end)},e.id)})})]}),(0,t.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark shadow p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Treinos da semana"}),(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Mostrando até 200"})]}),0===j.length?(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Nenhum treino programado para esta semana ainda."}):(0,t.jsx)("div",{className:"space-y-3",children:j.map(e=>{var a,s,r;let n=N[e.id],o=n?.status==="completed"?`Conclu\xeddo${n.performed_at?` (${d(n.performed_at)})`:""}`:n?.status==="in_progress"?"Em andamento":"—",c=!!e.locked_at||!!n,u=e.planned_day?`Ordem ${e.planned_day}`:e.planned_date?d(e.planned_date):d(e.created_at);return(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3 flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[u," · ",(s=e.status,r=e.closed_reason,"draft"===s?"Rascunho":"ready"===s?"Disponível":"archived"===s?"week_expired"===r?"Encerrado (sem execução)":"Encerrado":s)," · ",l[e.template_type]??e.template_type," ·"," ",null==(a=e.total_km)?"—":Number(a).toFixed(1).replace(".",",")," km"]}),(0,t.jsx)("div",{className:"font-medium truncate",children:e.title||l[e.template_type]||"Treino"}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Execução do aluno: ",(0,t.jsx)("span",{className:"font-semibold",children:o}),c?" · Edição bloqueada após início":""]})]}),(0,t.jsxs)("div",{className:"shrink-0 flex flex-wrap gap-2 justify-end",children:[(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-sm font-semibold disabled:opacity-50",disabled:c,onClick:()=>i.push(`/workouts/${e.id}/edit`),children:"Editar"}),(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg bg-primary text-slate-900 text-sm font-semibold disabled:opacity-50",disabled:"archived"===e.status,onClick:()=>P(e.id),children:"Gerar/Copiar link"}),(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg bg-slate-900 text-white text-sm font-semibold disabled:opacity-50",disabled:!e.share_slug,onClick:()=>{let t;!(t=e.share_slug)?D('Treino sem link (share_slug). Use "Gerar/Copiar link".'):i.push(`/w/${h}/${t}`)},children:"Ver como aluno"})]})]}),e.share_slug?(0,t.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Link: ",(0,t.jsxs)("span",{className:"font-mono",children:["/w/",h,"/",e.share_slug]})]}):(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Link ainda não gerado (share_slug vazio)."})]},e.id)})})]})]})]})})}e.s(["default",()=>m])}]);