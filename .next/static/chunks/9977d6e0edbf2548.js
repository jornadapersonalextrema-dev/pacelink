(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,a)=>{t.exports=e.r(76562)},46852,e=>{"use strict";var t=e.i(43476);let a=({title:e="PaceLink",showBack:a=!1,onBack:i,rightSlot:s,action:l,className:n=""})=>(0,t.jsx)("div",{className:`w-full bg-[#d1d1d1] ${n}`,children:(0,t.jsxs)("div",{className:"mx-auto max-w-2xl flex items-center justify-between px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[a?(0,t.jsx)("button",{type:"button",onClick:i,"aria-label":"Voltar",className:"text-white/90 hover:text-white",children:(0,t.jsx)("span",{className:"text-2xl leading-none",children:"‹"})}):null,(0,t.jsx)("div",{className:"text-white text-xl font-semibold truncate",children:e})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:s??l??null})]})});e.s(["Topbar",0,a,"default",0,a])},48978,e=>{"use strict";var t=e.i(43476);let a=({children:e,variant:a="primary",size:i="lg",icon:s,fullWidth:l=!0,className:n="",...r})=>(0,t.jsxs)("button",{className:`flex items-center justify-center gap-2 rounded-full font-bold transition-all active:scale-[0.98] ${{primary:"bg-primary text-background-dark shadow-lg shadow-primary/25 hover:bg-[#25c464]",secondary:"bg-white dark:bg-surface-dark border border-slate-200 dark:border-white/10 text-slate-900 dark:text-white",ghost:"bg-transparent text-slate-600 dark:text-slate-400 hover:bg-black/5 dark:hover:bg-white/5",danger:"bg-red-500 text-white shadow-lg shadow-red-500/20"}[a]} ${{sm:"h-9 px-4 text-xs",md:"h-11 px-6 text-sm",lg:"h-14 px-8 text-lg",xl:"h-16 px-10 text-xl"}[i]} ${l?"w-full":""} ${n}`,...r,children:[s&&(0,t.jsx)("span",{className:"material-symbols-outlined",children:s}),e]});e.s(["Button",0,a,"default",0,a])},5207,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(18566),s=e.i(27972),l=e.i(46852),n=e.i(48978);let r={easy_run:"Rodagem",progressive:"Progressivo",alternated:"Alternado"};function d(){return Math.random().toString(16).slice(2)}function o(e,t){let a=Number((e||"").replace(",","."));return Number.isFinite(a)?Math.max(t,a):t}function c({children:e}){return(0,t.jsx)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:e})}function u(){let e=(0,i.useRouter)(),u=(0,i.useParams)().id,m=(0,a.useMemo)(()=>(0,s.createClient)(),[]),[x,h]=(0,a.useState)(!0),[p,f]=(0,a.useState)(!1),[b,w]=(0,a.useState)(null),[g,j]=(0,a.useState)(null),[v,y]=(0,a.useState)(null),[k,N]=(0,a.useState)(null),[_,S]=(0,a.useState)(""),[C,$]=(0,a.useState)(""),[R,T]=(0,a.useState)(!1),[q,A]=(0,a.useState)("easy_run"),[D,K]=(0,a.useState)(!0),[M,B]=(0,a.useState)("2"),[E,L]=(0,a.useState)(!0),[P,F]=(0,a.useState)("1"),[I,U]=(0,a.useState)([]);function z(){return D?o(M,.5):1}function O(){return E?o(P,.5):1}function V(){return I.map((e,t)=>({index:t+1,distance_km:o(e.distanceKm,.5),intensity:e.intensity}))}function W(){let e=D?z():0,t=E?O():0;return Math.round((e+V().reduce((e,t)=>e+(t.distance_km||0),0)+t)*10)/10}function G(e,t){U(a=>a.map(a=>a.id===e?{...a,...t}:a))}async function H(){if(k){if(f(!0),w(null),R){w("Este treino já foi iniciado pelo aluno e não pode mais ser editado."),f(!1);return}try{let t={status:k.status,planned_date:C||null,template_type:q,title:_.trim()||null,include_warmup:D,warmup_km:z(),include_cooldown:E,cooldown_km:O(),blocks:V(),total_km:W()},{error:a}=await m.from("workouts").update(t).eq("id",k.id);if(a)throw a;w("Salvo!"),e.refresh()}catch(e){w(e?.message?`Erro: ${e.message}`:"Erro ao salvar.")}finally{f(!1)}}}async function J(){var e,t;let a,i;if(!k||!g)return;w(null);let{data:s,error:l}=await m.from("workouts").update({status:"ready"}).eq("id",k.id).select("id,share_slug").maybeSingle();if(l)return void w(l.message);let n=s?.share_slug;if(!n)return void w("share_slug vazio (trigger não gerou).");let r=g.public_slug||(e=g.name,t=g.id,a=(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")||"aluno",i=(t||"").replace(/-/g,"").slice(0,6)||"000000",`${a}-${i}`),d=`${window.location.origin}/w/${r}/${n}`;try{await navigator.clipboard.writeText(d),w("Link copiado!")}catch{w(`Link: ${d}`)}}return(0,a.useEffect)(()=>{let t=!0;return async function(){h(!0),w(null);let{data:{user:a}}=await m.auth.getUser();if(!a){let t=window.location.pathname+window.location.search;e.replace(`/login?next=${encodeURIComponent(t)}`);return}let{data:i,error:s}=await m.from("workouts").select("id,student_id,trainer_id,status,template_type,title,planned_date,locked_at,version,created_at,include_warmup,warmup_km,include_cooldown,cooldown_km,blocks,total_km,share_slug").eq("id",u).maybeSingle();if(!t)return;if(s){w(s.message),h(!1);return}if(!i){w("Treino não encontrado (ou sem permissão)."),h(!1);return}if(N(i),i?.week_id){let{data:e}=await m.from("weeks").select("id, week_start, week_end, label").eq("id",i.week_id).maybeSingle();y(e||null)}else y(null);S(i.title??""),$(i.planned_date??""),A(i.template_type??"easy_run"),K(!!i.include_warmup),B(String(i.warmup_km??"2")),L(!!i.include_cooldown),F(String(i.cooldown_km??"1"));let l=(Array.isArray(i.blocks)?i.blocks:[]).map(e=>({id:d(),distanceKm:String(e.distance_km??e.distanceKm??e.km??"1"),intensity:e.intensity??"moderado"}));U(l.length?l:[{id:d(),distanceKm:"6",intensity:"leve"}]);let{data:n,error:r}=await m.from("students").select("id,name,public_slug").eq("id",i.student_id).maybeSingle();if(r){w(r.message),h(!1);return}j(n);let{count:o}=await m.from("executions").select("id",{count:"exact",head:!0}).eq("workout_id",u);T(!!i.locked_at||(o??0)>0),h(!1)}(),()=>{t=!1}},[e,m,u]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.default,{title:"Editar treino"}),(0,t.jsxs)("main",{className:"flex-1 p-4",children:[x?(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Carregando…"}):b?(0,t.jsx)("div",{className:"rounded-xl bg-amber-50 dark:bg-amber-900/20 p-4 text-sm text-amber-800 dark:text-amber-200",children:b}):null,k&&g?(0,t.jsxs)("div",{className:"mx-auto max-w-3xl space-y-4",children:[(0,t.jsxs)(c,{children:[(0,t.jsx)("div",{className:"text-white/70 text-sm",children:"Aluno"}),(0,t.jsx)("div",{className:"text-white text-xl font-semibold",children:g.name}),(0,t.jsxs)("div",{className:"mt-3 text-sm text-white/70",children:["Template: ",(0,t.jsx)("span",{className:"font-semibold text-white",children:r[k.template_type]??k.template_type})]}),(0,t.jsxs)("div",{className:"mt-1 text-sm text-white/70",children:["Semana planejada:"," ",(0,t.jsx)("span",{className:"font-semibold text-white",children:v?v.label||`${new Date(v.week_start).toLocaleDateString("pt-BR")} – ${new Date(v.week_end).toLocaleDateString("pt-BR")}`:"—"})]}),(0,t.jsxs)("div",{className:"mt-1 text-sm text-white/70",children:["Distância total estimada: ",(0,t.jsxs)("span",{className:"font-semibold text-white",children:[W()," km"]})]}),R?(0,t.jsxs)("div",{className:"mt-3 rounded-xl border border-amber-400/30 bg-amber-500/10 p-3 text-sm text-amber-200",children:["Este treino já foi iniciado pelo aluno e está ",(0,t.jsx)("span",{className:"font-semibold",children:"bloqueado para edição"}),"."]}):null]}),(0,t.jsxs)(c,{children:[(0,t.jsx)("div",{className:"font-semibold text-white",children:"Título"}),(0,t.jsx)("input",{className:"mt-3 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-[#2ef57f]/30 disabled:opacity-60",value:_,disabled:R,onChange:e=>S(e.target.value),placeholder:"Ex: Rodagem leve"})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)("div",{className:"font-semibold text-white",children:"Data planejada (opcional)"}),(0,t.jsx)("input",{type:"date",className:"mt-3 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#2ef57f]/30 disabled:opacity-60",value:C,onChange:e=>$(e.target.value),disabled:R})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)("div",{className:"font-semibold text-white",children:"Template"}),(0,t.jsxs)("select",{className:"mt-3 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#2ef57f]/30 disabled:opacity-60",value:q,disabled:R,onChange:e=>A(e.target.value),children:[(0,t.jsx)("option",{value:"easy_run",children:"Rodagem"}),(0,t.jsx)("option",{value:"progressive",children:"Progressivo"}),(0,t.jsx)("option",{value:"alternated",children:"Alternado"})]})]}),(0,t.jsxs)(c,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"font-semibold text-white",children:"Aquecimento"}),(0,t.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm text-white/80",children:[(0,t.jsx)("input",{type:"checkbox",checked:D,onChange:()=>!R&&K(e=>!e)}),"Incluir"]})]}),(0,t.jsx)("input",{className:"mt-3 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#2ef57f]/30 disabled:opacity-60",value:M,onChange:e=>B(e.target.value),disabled:!D||R,inputMode:"decimal"})]}),(0,t.jsxs)(c,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"font-semibold text-white",children:"Blocos"}),(0,t.jsx)("button",{className:"text-sm underline text-white/80",onClick:()=>!R&&void U(e=>[...e,{id:d(),distanceKm:"1",intensity:"moderado"}]),children:"+ Adicionar bloco"})]}),(0,t.jsx)("div",{className:"mt-3 space-y-3",children:I.map((e,a)=>(0,t.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-white font-medium",children:["Bloco ",a+1]}),I.length>1?(0,t.jsx)("button",{className:"text-sm underline text-red-300",onClick:()=>{var t;return!R&&(t=e.id,void U(e=>e.filter(e=>e.id!==t)))},children:"Remover"}):null]}),(0,t.jsxs)("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-white/70",children:"Distância (km)"}),(0,t.jsx)("input",{className:"mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#2ef57f]/30 disabled:opacity-60",value:e.distanceKm,onChange:t=>!R&&G(e.id,{distanceKm:t.target.value}),inputMode:"decimal",disabled:R})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-white/70",children:"Intensidade"}),(0,t.jsx)("div",{className:"mt-2 flex gap-2",children:["leve","moderado","forte"].map(a=>(0,t.jsx)("button",{type:"button",disabled:R,onClick:()=>!R&&G(e.id,{intensity:a}),className:`flex-1 px-3 py-2 rounded-lg text-sm font-semibold whitespace-nowrap disabled:opacity-60 ${e.intensity===a?"bg-[#2ef57f] text-slate-900":"bg-white/10 text-white"}`,children:"leve"===a?"Leve":"moderado"===a?"Moderado":"Forte"},a))})]})]})]},e.id))})]}),(0,t.jsxs)(c,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"font-semibold text-white",children:"Desaquecimento"}),(0,t.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm text-white/80",children:[(0,t.jsx)("input",{type:"checkbox",checked:E,onChange:()=>!R&&L(e=>!e)}),"Incluir"]})]}),(0,t.jsx)("input",{className:"mt-3 w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-[#2ef57f]/30 disabled:opacity-60",value:P,onChange:e=>F(e.target.value),disabled:!E||R,inputMode:"decimal"})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,t.jsx)(n.default,{onClick:H,disabled:p||R,fullWidth:!0,children:"Salvar alterações"}),(0,t.jsx)(n.default,{onClick:J,disabled:p,fullWidth:!0,children:"Copiar link do aluno"})]}),(0,t.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:()=>e.push(`/students/${k.student_id}`),children:"Voltar para o aluno"})]}):null]})]})}e.s(["default",()=>u])}]);