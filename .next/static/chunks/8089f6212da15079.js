(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,a)=>{t.exports=e.r(76562)},46852,e=>{"use strict";var t=e.i(43476);let a=({title:e="PaceLink",showBack:a=!1,onBack:s,rightSlot:l,action:r,className:d=""})=>(0,t.jsx)("div",{className:`w-full bg-[#d1d1d1] ${d}`,children:(0,t.jsxs)("div",{className:"mx-auto max-w-2xl flex items-center justify-between px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[a?(0,t.jsx)("button",{type:"button",onClick:s,"aria-label":"Voltar",className:"text-white/90 hover:text-white",children:(0,t.jsx)("span",{className:"text-2xl leading-none",children:"‹"})}):null,(0,t.jsx)("div",{className:"text-white text-xl font-semibold truncate",children:e})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:l??r??null})]})});e.s(["Topbar",0,a,"default",0,a])},48978,e=>{"use strict";var t=e.i(43476);let a=({children:e,variant:a="primary",size:s="lg",icon:l,fullWidth:r=!0,className:d="",...i})=>(0,t.jsxs)("button",{className:`flex items-center justify-center gap-2 rounded-full font-bold transition-all active:scale-[0.98] ${{primary:"bg-primary text-background-dark shadow-lg shadow-primary/25 hover:bg-[#25c464]",secondary:"bg-white dark:bg-surface-dark border border-slate-200 dark:border-white/10 text-slate-900 dark:text-white",ghost:"bg-transparent text-slate-600 dark:text-slate-400 hover:bg-black/5 dark:hover:bg-white/5",danger:"bg-red-500 text-white shadow-lg shadow-red-500/20"}[a]} ${{sm:"h-9 px-4 text-xs",md:"h-11 px-6 text-sm",lg:"h-14 px-8 text-lg",xl:"h-16 px-10 text-xl"}[s]} ${r?"w-full":""} ${d}`,...i,children:[l&&(0,t.jsx)("span",{className:"material-symbols-outlined",children:l}),e]});e.s(["Button",0,a,"default",0,a])},55213,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),l=e.i(27972),r=e.i(46852),d=e.i(48978);let i={easy_run:"Rodagem",progressive:"Progressivo",alternated:"Alternado"};function n(e){if(!e)return"";let t=e.split("-");if(3!==t.length)return e;let[a,s,l]=t;return`${l}/${s}/${a}`}function o(e,t){let a=Number(e);return Number.isFinite(a)?a:t}function c(){let e=(0,s.useRouter)(),c=(0,s.useParams)(),u=(0,a.useMemo)(()=>(0,l.createClient)(),[]),m=c.studentSlug,x=c.shareSlug,[p,h]=(0,a.useState)(!0),[g,b]=(0,a.useState)(null),[k,_]=(0,a.useState)(null),[f,v]=(0,a.useState)(null),[j,w]=(0,a.useState)(()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${s}`}),[N,y]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[$,T]=(0,a.useState)(""),[D,R]=(0,a.useState)(null);async function q(){h(!0),R(null);let{data:{user:t}}=await u.auth.getUser();if(!t){let t=window.location.pathname+window.location.search;e.replace(`/login?next=${encodeURIComponent(t)}`);return}let{data:a,error:s}=await u.from("students").select("id,name,public_slug,p1k_pace,trainer_id").or(`auth_user_id.eq.${t.id},user_id.eq.${t.id}`).maybeSingle();if(s){R(s.message),h(!1);return}if(!a){R("Seu usuário não está vinculado a um aluno."),h(!1);return}if(a.public_slug&&a.public_slug!==m){R("Este link não corresponde ao seu perfil de aluno."),h(!1);return}b(a);let{data:l,error:r}=await u.from("workouts").select("id,student_id,trainer_id,status,title,template_type,include_warmup,warmup_km,include_cooldown,cooldown_km,blocks,total_km,planned_date,share_slug,version,locked_at").eq("share_slug",x).maybeSingle();if(r){R(r.message),h(!1);return}if(!l){R("Treino não encontrado ou indisponível."),h(!1);return}if(l.student_id!==a.id){R("Este treino não pertence ao seu perfil."),h(!1);return}if("ready"!==l.status&&"archived"!==l.status){R("Este treino ainda não está disponível."),h(!1);return}_(l),N||y(String(l.total_km??""));let{data:d}=await u.from("executions").select("id,workout_id,status,started_at,last_event_at,completed_at,performed_at,total_elapsed_ms,rpe,comment,actual_total_km").eq("workout_id",l.id).order("last_event_at",{ascending:!1,nullsFirst:!1}).order("started_at",{ascending:!1}).limit(1),i=d&&d.length>0?d[0]:null;v(i),i&&(i.performed_at&&w(i.performed_at),null!=i.actual_total_km&&y(String(i.actual_total_km)),null!=i.rpe&&C(String(i.rpe)),i.comment&&T(i.comment)),h(!1)}async function A(){if(!k||!g)return;R(null);let e=new Date().toISOString(),t={workout_id:k.id,student_id:g.id,trainer_id:k.trainer_id,status:"in_progress",started_at:e,last_event_at:e,performed_at:j||null,locked_version:k.version,workout_version:k.version,client_meta:{source:"portal_aluno"}},{data:a,error:s}=await u.from("executions").insert(t).select().maybeSingle();s?R(s.message||"Não foi possível iniciar a execução."):v(a)}async function E(){if(!f||!k)return;R(null);let e=new Date().toISOString(),t=f.started_at?new Date(f.started_at).getTime():Date.now(),a={status:"completed",completed_at:e,last_event_at:e,total_elapsed_ms:Math.max(0,Date.now()-t),performed_at:j||null,actual_total_km:N?o(N,k.total_km):k.total_km,rpe:S?Math.max(1,Math.min(10,o(S,0))):null,comment:$?$.trim():null,actual_blocks:k.blocks??[]},{data:s,error:l}=await u.from("executions").update(a).eq("id",f.id).select().maybeSingle();l?R(l.message||"Não foi possível concluir a execução."):v(s)}(0,a.useEffect)(()=>{q()},[m,x]);let M=!!k&&(!f||"completed"===f.status),P=f?.status==="in_progress",B=f?.status==="completed";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.default,{title:"Treino do Aluno",action:(0,t.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:()=>e.push("/aluno"),children:"Voltar"})}),(0,t.jsx)("main",{className:"flex-1 p-4",children:p?(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Carregando…"}):D?(0,t.jsx)("div",{className:"rounded-xl bg-red-50 dark:bg-red-900/20 p-4 text-sm text-red-700 dark:text-red-300",children:D}):k&&g?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark p-4 shadow",children:[(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Aluno"}),(0,t.jsx)("div",{className:"text-lg font-semibold",children:g.name}),(0,t.jsxs)("div",{className:"mt-1 text-sm text-slate-600 dark:text-slate-300",children:[k.planned_date?`Planejado para ${n(k.planned_date)} \xb7 `:"",i[k.template_type]??k.template_type," · ",k.total_km," km"]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Título"}),(0,t.jsx)("div",{className:"font-medium",children:k.title||i[k.template_type]||"Treino"})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark p-4 shadow space-y-3",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Estrutura"}),k.include_warmup&&(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3",children:[(0,t.jsx)("div",{className:"font-medium",children:"Aquecimento"}),(0,t.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[k.warmup_km," km"]})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3",children:[(0,t.jsx)("div",{className:"font-medium mb-2",children:"Blocos"}),(0,t.jsx)("div",{className:"space-y-2",children:0===(k.blocks??[]).length?(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Nenhum bloco definido."}):(k.blocks??[]).map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("div",{className:"truncate",children:["Bloco ",a+1," · ",String(e.intensity??"").toUpperCase()]}),(0,t.jsxs)("div",{className:"font-semibold",children:[e.distance_km??e.distanceKm??e.km??"—"," km"]})]},a))})]}),k.include_cooldown&&(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 dark:border-slate-700 p-3",children:[(0,t.jsx)("div",{className:"font-medium",children:"Desaquecimento"}),(0,t.jsxs)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[k.cooldown_km," km"]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl bg-white dark:bg-surface-dark p-4 shadow space-y-3",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Registro do realizado"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Data realizada"}),(0,t.jsx)("input",{type:"date",value:j,onChange:e=>w(e.target.value),className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Distância realizada (km)"}),(0,t.jsx)("input",{inputMode:"decimal",value:N,onChange:e=>y(e.target.value),placeholder:String(k.total_km),className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"RPE (1–10)"}),(0,t.jsx)("input",{inputMode:"numeric",value:S,onChange:e=>C(e.target.value),placeholder:"Opcional",className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Comentário (opcional)"}),(0,t.jsx)("textarea",{value:$,onChange:e=>T(e.target.value),rows:3,placeholder:"Como você se sentiu? Alguma observação?",className:"mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2"})]})]}),B?(0,t.jsxs)("div",{className:"rounded-xl bg-green-50 dark:bg-green-900/20 p-3 text-sm text-green-800 dark:text-green-200",children:["Treino concluído",f?.performed_at?` em ${n(f.performed_at)}`:"","."]}):P?(0,t.jsx)("div",{className:"rounded-xl bg-amber-50 dark:bg-amber-900/20 p-3 text-sm text-amber-800 dark:text-amber-200",children:"Execução em andamento."}):(0,t.jsx)("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:"Quando iniciar e concluir, o treino ficará registrado no seu histórico."}),(0,t.jsxs)("div",{className:"flex gap-2",children:[M&&(0,t.jsx)(d.default,{onClick:A,fullWidth:!0,children:"Iniciar execução"}),P&&(0,t.jsx)(d.default,{onClick:E,fullWidth:!0,children:"Concluir execução"})]}),B&&(0,t.jsx)("button",{className:"text-sm underline text-slate-600 dark:text-slate-300",onClick:A,children:"Registrar nova tentativa"})]})]}):null})]})}e.s(["default",()=>c])}]);